<html>
<head>
    <link href="/static/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="all">
    <style type="text/css">
        .name { font-weight: bold; }
        .description { font-style: italic; }
        .technologies { }

        table {font-size: 14px;}
        table tr {padding:3px;}
        table tr td {padding:3px; vertical-align: top;}

        .vote .gold { color: gold; }
        .vote .silver{ color: silver; }
        .vote .bronze { color: brown; }

        .vote form { display: inline-block; }
        .padd { padding-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Project Chooser</h1>

        <br>

        <h4>Welcome <span class="userId"></span></h4>
        <p>Below you can see a list of existing proposals for the current domain. You can support on any one you like, or add your own</p>

        <div class="container proposalsGet-HTML"></div>
    </div>
    <div class="container">
        <h2>Add Proposal</h2>
        <form>
            <input type="text" name="name" id="name" placeholder="Name" />
            <br />

            <input type="text" name="description" id="description" placeholder="Description" />
            <br />

            <input type="text" name="technologiesUsed" id="technologiesUsed" placeholder="Technologies Used" />
            <br />

            <input type="submit" value="Add Proposal" onclick="addProposal(); return false;"/>
        </form>
    </div>
    <script src="/static/resources/js/ajax-utils.js"></script>
    <script src="/static/resources/js/tmpl-fetcher.js"></script>
    <script src="/static/resources/js/lib/underscore.js"></script>
    <script src="/static/resources/js/lib/jquery-1.8.2.min.js"></script>
    <script src="/static/resources/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript">
        function addProposal()
        {
            ajax('post', '/api/proposals?name=' + $('#name').val() + '&description=' + $('#description').val() + '&technologiesUsed=' + $('#technologiesUsed').val(), '', function() { loadPage(); })
        }

        function withdraw(voteId)
        {
            ajax('delete', '/api/votes?voteId=' + voteId, '', function() { loadPage(); });
        }

        function vote(proposalId, weight)
        {
            ajax('post', '/api/votes?proposalId=' + proposalId + '&weight=' + weight, '', function() { loadPage(); });
        }

        function loadPage()
        {
            ajax('get', '/api/backers', '', function(backer) {
                $('.userId').html(backer.userId);

                ajax('get', '/api/proposals', '', function(proposals) {
                    fetchTmpl(PROPOSALS_TMPL_URL, function(tmpl) {
                        var renderedHtml = _.template(tmpl, { proposals: proposals, currentBacker: backer });
                        $('.proposalsGet-HTML').html(renderedHtml);
                    });
                });
            });
        }

        loadPage();
    </script>
</body>
</html>